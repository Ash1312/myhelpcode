

<?php
/**
 * Theme functions and definitions.
 * This child theme was generated by Merlin WP.
 *
 * @link https://developer.wordpress.org/themes/basics/theme-functions/
 */

/*
 * If your child theme has more than one .css file (eg. ie.css, style.css, main.css) then
 * you will have to make sure to maintain all of the parent theme dependencies.
 *
 * Make sure you're using the correct handle for loading the parent theme's styles.
 * Failure to use the proper tag will result in a CSS file needlessly being loaded twice.
 * This will usually not affect the site appearance, but it's inefficient and extends your page's loading time.
 *
 * @link https://codex.wordpress.org/Child_Themes
 */
function act_child_enqueue_styles() {
    wp_enqueue_style( 'parent-style' , get_template_directory_uri() . '/style.css' );
    wp_enqueue_style( 'act-child-style',
        get_stylesheet_directory_uri() . '/style.css',
        array( 'act-style' ),
        wp_get_theme()->get('Version')
    );
}

add_action(  'wp_enqueue_scripts', 'act_child_enqueue_styles', 99 );

function disable_noconflict() {
    wp_add_inline_script( 'jquery-core', '$ = jQuery;' );
}
add_action( 'wp_enqueue_scripts', 'disable_noconflict' );

//loading custom Scripts for ADMIN
function admin_js() {
    wp_register_script('admin_js', get_stylesheet_directory_uri() . '/admin/admin.js',  array('jquery'));
    wp_enqueue_script('admin_js');
}
add_action('admin_enqueue_scripts', 'admin_js');

function my_custom_scripts() {
    wp_enqueue_script( 'custom-js', get_stylesheet_directory_uri() . '/js/custom.js', array( 'jquery' ),'',true );
}
add_action( 'wp_enqueue_scripts', 'my_custom_scripts' );

function themeslug_enqueue_script() {
    wp_enqueue_script( 'jquery-v-2', 'https://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js', false );
}

add_action( 'wp_enqueue_scripts', 'themeslug_enqueue_script' );



//loading custom style for ADMIN
function load_admin_style() {
    wp_enqueue_style( 'admin_css', get_stylesheet_directory_uri() . '/admin/admin-styles.css', false, '1.0.0' );
   }

add_action( 'admin_enqueue_scripts', 'load_admin_style' );



add_action( 'wp_ajax_my_ajax_action_callback', 'my_ajax_action_callback' );
add_action('wp_ajax_nopriv_my_ajax_action_callback','my_ajax_action_callback' );

function my_ajax_action_callback(){

    $fname = $_POST['fname'];
    $lname = $_POST['lname'];
    $email = $_POST['email'];
    $member_image = $_FILES['file'];
    $description = $_POST['description'];
    $title= $_POST['fname'].' '.$_POST['lname'];

    $spot_price = $_POST['spot_price'];
    $sp_price=explode(",",$spot_price);

    $spot_desc  = $_POST['spot_desc'];
    $sp_desc=explode(",",$spot_desc);

    $spot_name = $_POST ['spot_name'];
    $sp_name=explode(",",$spot_name);

    $spot_image0 = $_FILES['spot_image0'];
    $spot_image1 = $_FILES['spot_image1'];
    $spot_image2 = $_FILES['spot_image2'];
    $spot_image3 = $_FILES['spot_image3'];

    $event_name = $_POST['event_name'];
    $event_start = $_POST['event_start'];
    $event_end = $_POST['event_end'];
    $spot = $_POST['spot'];
   

    $CurrentUserData = wp_get_current_user();
    $CurrentUserEmail =$CurrentUserData->data->user_email;
    $CurrentUserName =$CurrentUserData->data->display_name;

    function generateRandomString($length = 10) {
        return substr(str_shuffle(str_repeat($x='0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', ceil($length/strlen($x)) )),1,$length);
    }
    $pass = generateRandomString();

    global $current_user; 


    $my_post_evnt = array(
      'post_type'     => 'product',      
      'post_title'    => $title,
      'post_content'  => $description,
      'post_status'   => 'publish',
      'author'   => $current_user->ID,
    );

    $created_member = wp_insert_post( $my_post_evnt, true );
    wp_set_object_terms( $created_member, 'variable', 'product_type' );

    update_field('fname',$fname, $created_member);
    update_field('lname',$lname, $created_member);
    update_field('email',$email, $created_member);
    // update_field('events',$event_name, $created_member);

    // $username_exist  = username_exists( $fname );
    // $email_exist     = email_exists( $email );   

    // if ( $username_exist) {
    //     $result='<div class="alert alert-danger">Username Already Exists ! Please Try Again with different Username</div>';
    // }elseif ($email_exist ) {
    //     $result='<div class="alert alert-danger">Email Already Exists ! Please Try Again with different Email</div>';
    // }elseif (!$username_exist && !$email_exist) {

    //     $membercreated = wp_create_user( $fname, $pass, $email );
    //     $usercreated = new WP_User($membercreated);
    //     $usercreated->set_role('give_worker');
    if (!empty($created_member)) {

        $membercreated = wp_create_user( $fname, $pass, $email );
        $usercreated = new WP_User($membercreated);
        $usercreated->set_role('give_worker');

        $htmlContent = '<html>
                        <head>
                            <title>Email Newsletter</title>
                            <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">
                            <style>
                            tr.social-icons td a img {
                            margin: 0 2px;
                            max-width: 30px;
                            min-height: 22px;
                            object-fit: contain;
                            }
                            tr.social-icons td a {
                                display: block;
                            }
                        </style>
                        </head>
                        <body style="width: 100%; max-width: 808px; margin: 0 auto; text-align: center;">
                        <table cellpadding="0" cellspacing="0" border="0" style="width: 808px; margin: 0 auto; background-color: #fff; text-align: left;" bgcolor="#fff"> 
                            <tr>
                            <td height="35"></td>
                            <td height="35"></td>
                            <td height="35"></td>
                            </tr>
                            <tr>
                                <td width="50%" align="center">
                                <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                <td width="30"></td>
                                <td align="center" valign="center"><a href="https://devfundraising.wpengine.com"><img src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png" width="100%"></a></td>
                                <td width="30"></td>
                                </tr>
                                </table>
                                </td>
                                <td style="background-color: #D8D8D8; width: 3px">&nbsp;</td>
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                    <td width="30"></td>
                                    <td>
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                <td>
                                <div style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 37px; font-weight: bold; letter-spacing: 0; line-height: 51px; margin: 0">Yves Ballenegger</div>
                                </td>
                                    </tr>
                                    <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                    <tr>
                                    <td width="7%" valign="top">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr><td style="padding-top: 5px"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/location.png"></td></tr></table>
                                </td><td width="93%" valign="top" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">20845 McCormick Rd. Alexadria, On, Canada, KOC1A0</td></tr>
                                        </table>
                                            </td>
                                        </tr><tr><td height="8"></td></tr>
                                        <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                        <tr>
                                            <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone-call.png" width="18px"></td>
                                            <td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;"> 1-888-GROOVYY (Toll Free)</td>
                                </tr></table></td></tr>
                                <tr><td height="10"></td></tr>
                                <tr><td>
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone.png"></td><td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">514-578-5008</td>
                                </tr></table></td></tr></table>
                                    </td>
                                    <td width="30"></td>
                                </tr>
                                    </table>
                                </td>
                                </tr>
                                <tr>
                                    <td height="80"></td>
                                </tr>
                                <p style="text-align:left;">Hi Dear Member, <br>
                                    You are successfully registered on the fundraising website, the account details are given below:
                                </p>
                                <tr margin-top="20px";> 
                                <th style="text-align:left;">Name:</th><td style="text-align:left; width:50%;">'.$fname.'</td> 
                                </tr> 
                                <tr> 
                                    <th style="text-align:left;">Email:</th><td style="text-align:left; width:50%;">'.$email.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Password:</th><td style="text-align:left; width:50%;">'.$pass.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Organizer Name::</th><td style="text-align:left; width:50%;">'.$CurrentUserName.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;width: 50%;">Event Name:</th><td style="text-align:left;
                                    width: 50%;">'.$event_name.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left; width: 50%;">Event Start Date:</th><td style="text-align:left; width: 50%;">'.$event_start.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left; width: 50%;">Event End Date:</th><td style="text-align:left; width: 50%;">'.$event_end.'</td> 
                                </tr>
                                <tr margin-bottom="20px"; > 
                                 <th style="text-align:left; width: 50%;">Text for spot:</th><td style="text-align:left; width: 50%;">'.$spot.'</td> 
                                </tr >
                                <tr>
                                    <td height="30"></td>
                                </tr>
                                <p style="text-align:left;">
                                    Thanks!<br>
                                    Team Fundraising Event
                                </p>
                                <tr bgcolor="#01999A">
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                <tr>
                                    <td width="10%"></td>
                                    <td>
                                        <a style="color: #fff; padding: 0 0 0 10px; text-decoration: none;" href="mailto:www.fundraisingevent.com">www.fundraisingevent.com</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                </table>
                                </td>
                                    <td></td>
                                    <td width="50%">
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%">
                                    <tr>
                                        <td height="7"></td>
                                    </tr>
                                    <tr align="right" class="social-icons">
                                        <td width="44%"></td>
                                        <td width="10%" align="right"><a href="#" valign="middle"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/youtube.png"></a></td>
                                        <td width="10%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/facebook.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="10%" align="center" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/instagram.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="8%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/twitter.png"></a></td>
                                        <td width="8%"></td>
                                    </tr>
                                    <tr>
                                    <td height="7"></td>
                                        </tr>
                                    </table>
                                    </td>
                                </tr>
                            </table>
                        </body>
                        </html>';


             // Set content-type header for sending HTML email 
            $headers = "MIME-Version: 1.0" . "\r\n"; 
            $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
             
            // Additional headers 
            $headers .= 'From: '.$CurrentUserName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
            $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

            mail($email ,$fname, $htmlContent, $headers);
    }
 
        if ($member_image) {
            $upload_overrides = array( 'test_form' => false );
            $upload = wp_handle_upload($member_image, $upload_overrides);
            $new = $upload['url'];
            $filename = $upload['file'];
            $filetype = wp_check_filetype( basename( $filename ), null );
            $wp_upload_dir = wp_upload_dir();
            $attachment = array(
                'guid'           => $wp_upload_dir['url'] . '/' . basename( $filename ),
                'post_mime_type' => $filetype['type'],
                'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filename ) ),
                'post_content'   => '',
                'post_status'    => 'inherit'
            );
            $attach_id = wp_insert_attachment( $attachment, $filename );
            add_post_meta($created_member, '_thumbnail_id', $attach_id);
            set_post_thumbnail( $created_member, $attach_id );

            require_once( ABSPATH . 'wp-admin/includes/image.php' );
            $attach_data = wp_generate_attachment_metadata( $attach_id, $filename );
            wp_update_attachment_metadata( $attach_id, $attach_data );
            $images_data = array_push($galleryImages, $attach_id);

        }


    //for variation image
    if ($spot_image0) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image0, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id0 = wp_insert_attachment( $spot_attachment, $filenamee );
        add_post_meta($created_member, '_thumbnail_id', $spot_image_id0);
        set_post_thumbnail( $created_member, $spot_image_id0 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id0, $filenamee );
        wp_update_attachment_metadata( $spot_image_id0, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id0);

        
    }
    if ($spot_image1) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image1, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id1 = wp_insert_attachment( $spot_attachment, $filenamee );
        add_post_meta($created_member, '_thumbnail_id', $spot_image_id1);
        set_post_thumbnail( $created_member, $spot_image_id1 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id1, $filenamee );
        wp_update_attachment_metadata( $spot_image_id1, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id1);

        
    }

    if ($spot_image2) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image2, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id2 = wp_insert_attachment( $spot_attachment, $filenamee );
        add_post_meta($created_member, '_thumbnail_id', $spot_image_id2);
        set_post_thumbnail( $created_member, $spot_image_id2 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id2, $filenamee );
        wp_update_attachment_metadata( $spot_image_id2, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id2);

        
    }

    if ($spot_image3) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image3, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id3 = wp_insert_attachment( $spot_attachment, $filenamee );
        add_post_meta($created_member, '_thumbnail_id', $spot_image_id3);
        set_post_thumbnail( $created_member, $spot_image_id3 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id3, $filenamee );
        wp_update_attachment_metadata( $spot_image_id3, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id3);

        
    }

        //adding spots
        $attr_label = 'Spot';
        $attr_slug = sanitize_title($attr_label);

        $attributes_array[$attr_slug] = array(
        'name' => $attr_label,
        'value' => $sp_name[0] .'|'. $sp_name[1] .'|'. $sp_name[2] .'|'. $sp_name[3],
        'is_visible' => '1',
        'is_variation' => '1',
        'is_taxonomy' => '0' // for some reason, this is really important       
        );
        update_post_meta( $created_member, '_product_attributes', $attributes_array );

        $parent_id = $created_member;
        $variation = array(
        'post_title'   =>  $sp_name[0]. ' (variation)',
        'post_content' => '',
        'post_status'  => 'publish',
        'post_parent'  => $parent_id,
        'post_type'    => 'product_variation'
        );

        $variation_id = wp_insert_post( $variation );

        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[0] );
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[0] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[0]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id0);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[0]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );



        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[1]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[1] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[1]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id1);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[1]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );

        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[2]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[2] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[2]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id2);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[2]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );



        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[3]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[3] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[3]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id3);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[3]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );

    die();
}




add_action( 'wp_ajax_AddNewEvent_callback', 'AddNewEvent_callback' );
add_action('wp_ajax_nopriv_AddNewEvent_callback','AddNewEvent_callback' );

function AddNewEvent_callback(){

    $event_name = $_POST['event_name'];
    $event_image = $_FILES['event_image'];
    $event_start = $_POST['event_start'];
    $event_end = $_POST['event_end'];
    $spot = $_POST['spot'];

    $CurrentUserData = wp_get_current_user();
    $CurrentUserEmail =$CurrentUserData->data->user_email;
    $CurrentUserName =$CurrentUserData->data->display_name;
    $admin_email=get_option('admin_email');

    $my_post_evnt = array(
      'post_type'     => 'tribe_events',      
      'post_title'    => $event_name,
      'post_content'  => $spot,
      'post_status'   => 'publish',
      'post_author'   => get_current_user_id(),
    );

    $created_evnt = wp_insert_post( $my_post_evnt, true );
    
    if ($created_evnt) {

         $htmlContent = '<html>
                        <head>
                            <title>Email Newsletter</title>
                            <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">
                            <style>
                            tr.social-icons td a img {
                            margin: 0 2px;
                            max-width: 30px;
                            min-height: 22px;
                            object-fit: contain;
                            }
                            tr.social-icons td a {
                                display: block;
                            }
                        </style>
                        </head>
                        <body style="width: 100%; max-width: 808px; margin: 0 auto; text-align: center;">
                        <table cellpadding="0" cellspacing="0" border="0" style="width: 808px; margin: 0 auto; background-color: #fff; text-align: left;" bgcolor="#fff"> 
                            <tr>
                            <td height="35"></td>
                            <td height="35"></td>
                            <td height="35"></td>
                            </tr>
                            <tr>
                                <td width="50%" align="center">
                                <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                <td width="30"></td>
                                <td align="center" valign="center"><a href="https://devfundraising.wpengine.com"><img src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png" width="100%"></a></td>
                                <td width="30"></td>
                                </tr>
                                </table>
                                </td>
                                <td style="background-color: #D8D8D8; width: 3px">&nbsp;</td>
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                    <td width="30"></td>
                                    <td>
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                <td>
                                <div style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 37px; font-weight: bold; letter-spacing: 0; line-height: 51px; margin: 0">Yves Ballenegger</div>
                                </td>
                                    </tr>
                                    <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                    <tr>
                                    <td width="7%" valign="top">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr><td style="padding-top: 5px"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/location.png"></td></tr></table>
                                </td><td width="93%" valign="top" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">20845 McCormick Rd. Alexadria, On, Canada, KOC1A0</td></tr>
                                        </table>
                                            </td>
                                        </tr><tr><td height="8"></td></tr>
                                        <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                        <tr>
                                            <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone-call.png" width="18px"></td>
                                            <td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;"> 1-888-GROOVYY (Toll Free)</td>
                                </tr></table></td></tr>
                                <tr><td height="10"></td></tr>
                                <tr><td>
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone.png"></td><td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">514-578-5008</td>
                                </tr></table></td></tr></table>
                                    </td>
                                    <td width="30"></td>
                                </tr>
                                    </table>
                                </td>
                                </tr>
                                <tr>
                                    <td height="80"></td>
                                </tr>
                                <p style="text-align:left;">Hi Dear Member, <br>
                                    You have Created An Event for the fundraising, the details are given below:
                                </p>
                                <tr> 
                                    <th style="text-align:left;">Event Name:</th><td style="text-align:left; width:50%;">'.$event_name.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Event Start Date:</th><td style="text-align:left; width:50%;">'.$event_start.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Event End Date:</th><td style="text-align:left; width:50%;">'.$event_end.'</td> 
                                </tr>
                                <tr margin-bottom="20px"; > 
                                 <th style="text-align:left;">Text for spot:</th><td style="text-align:left; width:50%;">'.$spot.'</td> 
                                </tr >
                                <tr>
                                    <td height="30"></td>
                                </tr>
                                <p style="text-align:left;">
                                    Thanks!<br>
                                    Team Fundraising Event
                                </p>
                                <tr bgcolor="#01999A">
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                <tr>
                                    <td width="10%"></td>
                                    <td>
                                        <a style="color: #fff; padding: 0 0 0 10px; text-decoration: none;" href="https://devfundraising.wpengine.com/">www.fundraisingevent.com</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                </table>
                                </td>
                                    <td></td>
                                    <td width="50%">
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%">
                                    <tr>
                                        <td height="7"></td>
                                    </tr>
                                    <tr align="right" class="social-icons">
                                        <td width="44%"></td>
                                        <td width="10%" align="right"><a href="#" valign="middle"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/youtube.png"></a></td>
                                        <td width="10%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/facebook.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="10%" align="center" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/instagram.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="8%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/twitter.png"></a></td>
                                        <td width="8%"></td>
                                    </tr>
                                    <tr>
                                    <td height="7"></td>
                                        </tr>
                                    </table>
                                    </td>
                                </tr>
                            </table>
                        </body>
                        </html>';


             // Set content-type header for sending HTML email 
            $headers = "MIME-Version: 1.0" . "\r\n"; 
            $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
             
            // Additional headers 
            $headers .= 'From: <'.$admin_email.'>' . "\r\n"; 
            $headers .= 'Reply-to:'.$admin_email. "\r\n"; 

            mail($CurrentUserEmail ,$CurrentUserName, $htmlContent, $headers);

      }  
    
    if (isset($event_image)) {
            $upload_overrides = array( 'test_form' => false );
            $upload = wp_handle_upload($event_image, $upload_overrides);
            $new = $upload['url'];
            $filename = $upload['file'];
            $filetype = wp_check_filetype( basename( $filename ), null );
            $wp_upload_dir = wp_upload_dir();
            $attachment = array(
                'guid'           => $wp_upload_dir['url'] . '/' . basename( $filename ),
                'post_mime_type' => $filetype['type'],
                'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filename ) ),
                'post_content'   => '',
                'post_status'    => 'inherit'
            );
            $attach_id = wp_insert_attachment( $attachment, $filename );

    }
    add_post_meta($created_evnt, '_thumbnail_id', $attach_id);
    add_post_meta($created_evnt, '_EventStartDate',$event_start);
    add_post_meta($created_evnt, '_EventEndDate',$event_end);

    $eventImage = get_the_post_thumbnail($created_evnt);

    echo json_encode(array(
        'created_evnt' => $created_evnt
    ));

    die();

}


add_action( 'wp_ajax_DeleteMember_callback', 'DeleteMember_callback' );
add_action('wp_ajax_nopriv_DeleteMember_callback','DeleteMember_callback' );

function DeleteMember_callback(){

    $post_id = $_POST['post_id'];
    $deleted_evnt = wp_delete_post($post_id);

    die();

}


add_action( 'wp_ajax_UpdateMember_callback', 'UpdateMember_callback' );
add_action('wp_ajax_nopriv_UpdateMember_callback','UpdateMember_callback' );

function UpdateMember_callback(){

    $post_id = $_POST['post_id'];

    $fname = $_POST['fname'];
    $lname = $_POST['lname'];
    $email = $_POST['email'];
    $member_image = $_FILES['file'];
    $description = $_POST['description'];
    $title= $_POST['fname'].' '.$_POST['lname'];


    $spot_price = $_POST['spot_price'];
    $sp_price=explode(",",$spot_price);

    $spot_desc  = $_POST['spot_desc'];
    $sp_desc=explode(",",$spot_desc);

    $spot_name = $_POST ['spot_name'];
    $sp_name=explode(",",$spot_name);

    $spot_image0 = $_FILES['spot_image0'];
    $spot_image1 = $_FILES['spot_image1'];
    $spot_image2 = $_FILES['spot_image2'];
    $spot_image3 = $_FILES['spot_image3'];
   

    function generateRandomString($length = 10) {
        return substr(str_shuffle(str_repeat($x='0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', ceil($length/strlen($x)) )),1,$length);
    }
    $pass = generateRandomString();

    global $current_user; 

    $update_team = array(
        'ID'          => $post_id,  
      'post_type'     => 'product',      
      'post_title'    => $title,
      'post_content'  => $description,
      'post_status'   => 'publish',
        'author'   => $current_user->ID,
    );

    $created_member = wp_update_post( $update_team, true);
    update_field('fname',$fname, $created_member);
    update_field('lname',$lname, $created_member);
    update_field('email',$email, $created_member);

    if ($member_image) {
            $upload_overrides = array( 'test_form' => false );
            $upload = wp_handle_upload($member_image, $upload_overrides);
            $new = $upload['url'];
            $filename = $upload['file'];
            $filetype = wp_check_filetype( basename( $filename ), null );
            $wp_upload_dir = wp_upload_dir();
            $attachment = array(
                'guid'           => $wp_upload_dir['url'] . '/' . basename( $filename ),
                'post_mime_type' => $filetype['type'],
                'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filename ) ),
                'post_content'   => '',
                'post_status'    => 'inherit'
            );
            $attach_id = update_attached_file( $attachment, $filename );
            update_post_meta($created_member, '_thumbnail_id', $attach_id);
            set_post_thumbnail( $created_member, $attach_id );

            require_once( ABSPATH . 'wp-admin/includes/image.php' );
            $attach_data = wp_generate_attachment_metadata( $attach_id, $filename );
            wp_update_attachment_metadata( $attach_id, $attach_data );
            $images_data = array_push($galleryImages, $attach_id);

        }


    if ($spot_image0) {

        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image0, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id0 = update_attached_file( $spot_attachment, $filenamee );
        update_post_meta($created_member, '_thumbnail_id', $spot_image_id0);
        set_post_thumbnail( $created_member, $spot_image_id0 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id0, $filenamee );
        wp_update_attachment_metadata( $spot_image_id0, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id0);

        
    }
    if ($spot_image1) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image1, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id1 = update_attached_file( $spot_attachment, $filenamee );
        update_post_meta($created_member, '_thumbnail_id', $spot_image_id1);
        set_post_thumbnail( $created_member, $spot_image_id1 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id1, $filenamee );
        wp_update_attachment_metadata( $spot_image_id1, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id1);

        
    }

    if ($spot_image2) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image2, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id2 = update_attached_file( $spot_attachment, $filenamee );
        update_post_meta($created_member, '_thumbnail_id', $spot_image_id2);
        set_post_thumbnail( $created_member, $spot_image_id2 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id2, $filenamee );
        wp_update_attachment_metadata( $spot_image_id2, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id2);

        
    }

    if ($spot_image3) {
        $uploadimage_overrides = array( 'test_form' => false );
        $upload = wp_handle_upload($spot_image3, $uploadimage_overrides);
        $new = $upload['url'];
        $filenamee = $upload['file'];
        $file_type = wp_check_filetype( basename( $filenamee ), null );
        $wp_upload_dirr = wp_upload_dir();
        $spot_attachment = array(
            'guid'           => $wp_upload_dirr['url'] . '/' . basename( $filenamee ),
            'post_mime_type' => $file_type['type'],
            'post_title'     => preg_replace( '/\.[^.]+$/', '', basename( $filenamee ) ),
            'post_content'   => '',
            'post_status'    => 'inherit'
        );
        $spot_image_id3 = update_attached_file( $spot_attachment, $filenamee );
        update_post_meta($created_member, '_thumbnail_id', $spot_image_id3);
        set_post_thumbnail( $created_member, $spot_image_id3 );
        
        require_once( ABSPATH . 'wp-admin/includes/image.php' );
        $attach_data_new = wp_generate_attachment_metadata( $spot_image_id3, $filenamee );
        wp_update_attachment_metadata( $spot_image_id3, $attach_data_new );
        $images_data = array_push($galleryImages, $spot_image_id3);

        
    }

        $attr_label = 'Spot';
        $attr_slug = sanitize_title($attr_label);

        $attributes_array[$attr_slug] = array(
        'name' => $attr_label,
        'value' => $sp_name[0] .'|'. $sp_name[1] .'|'. $sp_name[2] .'|'. $sp_name[3],
        'is_visible' => '1',
        'is_variation' => '1',
        'is_taxonomy' => '0' // for some reason, this is really important       
        );
        update_post_meta( $created_member, '_product_attributes', $attributes_array );

        $parent_id = $created_member;
        $variation = array(
        'post_title'   =>  $sp_name[0]. ' (variation)',
        'post_content' => '',
        'post_status'  => 'publish',
        'post_parent'  => $parent_id,
        'post_type'    => 'product_variation'
        );

        $variation_id = wp_insert_post( $variation );

        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[0] );
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[0] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[0]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id0);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[0]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );

        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[1]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[1] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[1]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id1);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[1]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );

        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[2]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[2] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[2]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id2);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[2]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );


        $variation_id = wp_insert_post( $variation );
        update_post_meta( $variation_id, 'attribute_' . $attr_slug, $sp_name[3]);
        update_post_meta( $variation_id, '_manage_stock', 'yes');
        update_post_meta( $variation_id, '_regular_price', $sp_price[3] );
        update_post_meta( $variation_id, '_stock', 1);
        update_post_meta( $variation_id, '_price', $sp_price[3]);
        update_post_meta( $variation_id, '_thumbnail_id', $spot_image_id3);
        update_post_meta( $variation_id, '_variation_description', $sp_desc[3]);
        // update_post_meta( $variation_id, '_price', 2 );
        // update_post_meta( $variation_id, '_stock_qty', 10 );
        WC_Product_Variable::sync( $parent_id );


    die();

}


add_action( 'wp_ajax_editMember_callback', 'editMember_callback' );
add_action('wp_ajax_nopriv_editMember_callback','editMember_callback' );

function editMember_callback(){
   
    $id = $_POST['id'];
    $memberImage = get_the_post_thumbnail_url($id);

    $post = get_post($id);
    $product_data = wc_get_product($id);
    $product_variation = $product_data->get_available_variations();

    $member_fname = get_field('fname', $id);
    $member_lname = get_field('lname', $id);
    $member_email = get_field('email', $id);    

    $edit_html = '';
    $edit_html .=' 
    <div class="form-image">
       <div class="first-step">
          <h2>Team Member</h2>
          <div class="form-group">
             <label for="#">First Name</label>
             <input type="text" id="first-name-edit" name="update_fname" value="'.$member_fname.'">
          </div>
          <div class="form-group">
             <label for="#">Last Name</label>
             <input type="text" id="last-name-edit" name="update_lname" value="'.$member_lname.'">
          </div>
          <div class="form-group">
             <label for="#">Email</label>
             <input type="email" id="email-edit" name="update_email" value="'.$member_email.'">
          </div>
          <div class="form-group textarea">
             <label for="#">Discription</label>
             <textarea id="description-edit" name="update_desc" value="">'.$post->post_content.'</textarea>
          </div>
       </div>
       <div class="avatar-upload">
          <div class="avatar-edit">
             <input type="file" id="imageUpload" accept=".png, .jpg, .jpeg">
             <label for="imageUpload"></label>
          </div>
          <div class="avatar-preview">
             <div id="imagePreview-member" class="member-preview" style="background-image: url('.$memberImage.');">
             </div>
          </div>
       </div>
    </div>';


    $data=[];
    foreach ($product_variation as $key => $value) {
        $edit_html .='
            <div class="form-image spot-'.$key.'">
               <div class="first-step under-line">
                  <h2>Spots</h2>
                  <div class="form-group">
                     <label for="#">Spot Name</label>
                     <input type="text" id="spot-name-edit" name="update_spotname" value="'.$value['attributes']['attribute_spot'].'">
                  </div>
                  <div class="form-group">
                     <label for="#">Price</label>
                     <input type="number" id="spot-price-edit" name="update_price" value="'.$value['display_regular_price'].'">
                  </div>
                  <div class="form-group textarea">
                     <label for="#">Discription</label>
                     <textarea id="spot-description-edit" name="update_spotdesc" value="">'.strip_tags($value['variation_description']).'</textarea>
                  </div>
                  <!--  -->
                  <div class="button-save">
                     <button type="button" onclick="UpdateTeamMember()" class="btn">Update</button>
                     <button type="button" onclick="deleteMember('.$id.')" class="btn delete">Delete</button>
                     <div class="loader" style="display: none;"></div>
                  </div>
               </div>
               <div class="avatar-upload">
                  <div class="avatar-edit spots_edits">
                     <input type="file" id="imageUpload'.$key.'" data-file="'.$key.'" accept=".png, .jpg, .jpeg">
                     <label for="imageUpload"></label>
                  </div>
                  <div class="avatar-preview">
                     <div id="imagePreview-spot_'.$key.'" class="spot-preview" style="background-image: url('.$value['image']['url'].');">
                     </div>
                  </div>
               </div>
            </div>
        ';
    }

echo $edit_html;

    die();
}

add_action( 'wp_ajax_submit_callback', 'submit_callback' );
add_action('wp_ajax_nopriv_submit_callback','submit_callback' );
function submit_callback(){

    echo "testing";
    $event_name = $_POST['event_name'];
    $event_start = $_POST['event_start'];
    $event_end = $_POST['event_end'];
    $spot = $_POST['spot'];

    $CurrentUserData = wp_get_current_user();
    $CurrentUserEmail =$CurrentUserData->data->user_email;
    $CurrentUserName =$CurrentUserData->data->display_name;
    $admin_email=get_option('admin_email');


    $htmlContent = '<html>
                        <head>
                            <title>Email Newsletter</title>
                            <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">

                            <style>
                            tr.social-icons td a img {
                            margin: 0 2px;
                            max-width: 30px;
                            min-height: 22px;
                            object-fit: contain;
                            }
                            tr.social-icons td a {
                                display: block;
                            }
                        </style>
                        </head>
                        <body style="width: 100%; max-width: 808px; margin: 0 auto; text-align: center;">
                        <table cellpadding="0" cellspacing="0" border="0" style="width: 808px; margin: 0 auto; background-color: #fff; text-align: left;" bgcolor="#fff"> 
                            <tr>
                            <td height="35"></td>
                            <td height="35"></td>
                            <td height="35"></td>
                            </tr>
                            <tr>
                                <td width="50%" align="center">
                                <table cellpadding="0" cellspacing="0" border="0" width="100%">
                                <tr>
                                <td width="30"></td>
                                <td align="center" valign="center"><a href="https://devfundraising.wpengine.com"><img src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png" width="100%"></a></td>
                                <td width="30"></td>
                                </tr>
                                </table>
                                </td>
                                <td style="background-color: #D8D8D8; width: 3px">&nbsp;</td>
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                    <tr>
                                    <td width="30"></td>
                                    <td>
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                <td>
                                <div style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 37px; font-weight: bold; letter-spacing: 0; line-height: 51px; margin: 0">Yves Ballenegger</div>
                                </td>
                                    </tr>
                                    <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                    <tr>
                                    <td width="7%" valign="top">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr><td style="padding-top: 5px"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/location.png"></td></tr></table>
                                </td><td width="93%" valign="top" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">20845 McCormick Rd. Alexadria, On, Canada, KOC1A0</td></tr>
                                        </table>
                                            </td>
                                        </tr><tr><td height="8"></td></tr>
                                        <tr>
                                    <td>
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                        <tr>
                                            <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone-call.png" width="18px"></td>
                                            <td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;"> 1-888-GROOVYY (Toll Free)</td>
                                </tr></table></td></tr>
                                <tr><td height="10"></td></tr>
                                <tr><td>
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone.png"></td><td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">514-578-5008</td>
                                </tr></table></td></tr></table>
                                    </td>
                                    <td width="30"></td>
                                </tr>
                                    </table>
                                </td>
                                </tr>
                                <tr>
                                    <td height="80"></td>
                                </tr>
                                <h1>Event Information</h1>
                                <p style="text-align:left;">Hi Dear Admin, <br>
                                    A New Event have been registered for the Fundraising Event, the details are given below:
                                </p>
                                <tr> 
                                    <th style="text-align:left;">Event Name:</th><td style="text-align:left; width:50%;">'.$event_name.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Event Start Date:</th><td style="text-align:left; width:50%;">'.$event_start.'</td> 
                                </tr>
                                <tr> 
                                    <th style="text-align:left;">Event End Date:</th><td style="text-align:left; width:50%;">'.$event_end.'</td> 
                                </tr>
                                <tr margin-bottom="20px"; > 
                                 <th style="text-align:left;">Text for spot:</th><td style="text-align:left; width:50%;">'.$spot.'</td> 
                                </tr >
                                <tr>
                                    <td height="30"></td>
                                </tr>
                                <p style="text-align:left;">
                                    Thanks!<br>
                                    Team Fundraising Event
                                </p>
                                <tr bgcolor="#01999A">
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                <tr>
                                    <td width="10%"></td>
                                    <td>
                                        <a style="color: #fff; padding: 0 0 0 10px; text-decoration: none;" href="https://devfundraising.wpengine.com/">www.fundraisingevent.com</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                </table>
                                </td>
                                    <td></td>
                                    <td width="50%">
                                    <table cellpadding="0" cellspacing="0" border="0" style="width: 100%">
                                    <tr>
                                        <td height="7"></td>
                                    </tr>
                                    <tr align="right" class="social-icons">
                                        <td width="44%"></td>
                                        <td width="10%" align="right"><a href="#" valign="middle"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/youtube.png"></a></td>
                                        <td width="10%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/facebook.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="10%" align="center" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/instagram.png"></a></td>
                                        <td width="5%"></td>
                                        <td width="8%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/twitter.png"></a></td>
                                        <td width="8%"></td>
                                    </tr>
                                    <tr>
                                    <td height="7"></td>
                                        </tr>
                                    </table>
                                    </td>
                                </tr>
                            </table>
                        </body>
                        </html>';



             // Set content-type header for sending HTML email 
            $headers = "MIME-Version: 1.0" . "\r\n"; 
            $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
             
            // Additional headers 
            $headers .= 'From: '.$CurrentUserName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
            $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

            mail($admin_email ,$event_name, $htmlContent, $headers);

            die();
}


add_action( 'wp_ajax_AssignEvent_callback', 'AssignEvent_callback' );
add_action('wp_ajax_nopriv_AssignEvent_callback','AssignEvent_callback' );
function AssignEvent_callback(){


    $event_id = $_POST['event_id'];
    $member_id = $_POST['member_id'];
    echo $event_id;
    echo $member_id;

    $event_name = $_POST['event_name'];
    $event_start = $_POST['event_start'];
    $event_end = $_POST['event_end'];
    $spot = $_POST['spot'];

    $CurrentUserData = wp_get_current_user();
    $CurrentUserEmail =$CurrentUserData->data->user_email;
    $CurrentUserName =$CurrentUserData->data->display_name;

    // $event_name = $_POST['event_name'];
    $memberEmail=get_field('email', $member_id );
    // echo $memberEmail;

    $fname=get_field('fname', $member_id );
    // echo $fname;


    $assigned = update_field( 'field_5fdcf1db0c4bd', $event_id , $member_id );

    if ($assigned) {
    
    $htmlContent = '<html>
                    <head>
                        <title>Email Newsletter</title>
                        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">
                        <style>
                            tr.social-icons td a img {
                            margin: 0 2px;
                            max-width: 30px;
                            min-height: 22px;
                            object-fit: contain;
                            }
                            tr.social-icons td a {
                                display: block;
                            }
                        </style>
                        </head>
                    <body style="width: 100%; max-width: 808px; margin: 0 auto; text-align: center;">
                    <table cellpadding="0" cellspacing="0" border="0" style="width: 808px; margin: 0 auto; background-color: #fff; text-align: left;" bgcolor="#fff"> 
                        <tr>
                        <td height="35"></td>
                        <td height="35"></td>
                        <td height="35"></td>
                        </tr>
                        <tr>
                            <td width="50%" align="center">
                            <table cellpadding="0" cellspacing="0" border="0" width="100%">
                            <tr>
                            <td width="30"></td>
                            <td align="center" valign="center"><a href="https://devfundraising.wpengine.com"><img src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png" width="100%"></a></td>
                            <td width="30"></td>
                            </tr>
                            </table>
                            </td>
                            <td style="background-color: #D8D8D8; width: 3px">&nbsp;</td>
                            <td width="50%">
                            <table cellpadding="0" cellspacing="0" border="0">
                                <tr>
                                <td width="30"></td>
                                <td>
                            <table cellpadding="0" cellspacing="0" border="0">
                            <tr>
                            <td>
                            <div style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 37px; font-weight: bold; letter-spacing: 0; line-height: 51px; margin: 0">Yves Ballenegger</div>
                            </td>
                                </tr>
                                <tr>
                                <td>
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                <tr>
                                <td width="7%" valign="top">
                            <table cellpadding="0" cellspacing="0" border="0">
                            <tr><td style="padding-top: 5px"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/location.png"></td></tr></table>
                            </td><td width="93%" valign="top" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">20845 McCormick Rd. Alexadria, On, Canada, KOC1A0</td></tr>
                                    </table>
                                        </td>
                                    </tr><tr><td height="8"></td></tr>
                                    <tr>
                                <td>
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                                    <tr>
                                        <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone-call.png" width="18px"></td>
                                        <td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;"> 1-888-GROOVYY (Toll Free)</td>
                            </tr></table></td></tr>
                            <tr><td height="10"></td></tr>
                            <tr><td>
                            <table cellpadding="0" cellspacing="0" border="0" style="width: 100%;">
                            <td width="7%" valign="top"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/phone.png"></td><td width="93%" style="color: #4A4A4A; font-family: "Open Sans", sans-serif; font-size: 20px; font-weight: 400; letter-spacing: 0; line-height: 27px;">514-578-5008</td>
                            </tr></table></td></tr></table>
                                </td>
                                <td width="30"></td>
                            </tr>
                                </table>
                            </td>
                            </tr>  
                            <tr>
                                <td height="80"></td>
                            </tr>
                            <p style="text-align:left;">Hi Dear Member, <br>
                                You have been assigned for the Event, the details are given below:
                            </p>
                            <tr> 
                                <th style="text-align:left; width:50%;">Organizer Name:</th><td style="text-align:left; width:50%;">'.$CurrentUserName.'</td> 
                            </tr>
                            <tr> 
                                <th style="text-align:left; width:50%;">Event Name:</th><td style="text-align:left; width:50%;">'.$event_name.'</td> 
                            </tr>
                            <tr> 
                                <th style="text-align:left; width:50%;">Event Start Date:</th><td style="text-align:left; width:50%;">'.$event_start.'</td> 
                            </tr>
                            <tr> 
                                <th style="text-align:left; width:50%;">Event End Date:</th><td style="text-align:left; width:50%;">'.$event_end.'</td> 
                            </tr>
                            <tr margin-bottom="20px"; > 
                             <th style="text-align:left; width:50%;">Text for spot:</th><td style="text-align:left; width:50%;">'.$spot.'</td> 
                            </tr >
                            <tr>
                                <td height="30"></td>
                            </tr>
                                <p style="text-align:left;">
                                    Thanks!<br>
                                    Team Fundraising Event
                                </p>
                            
                            <tr bgcolor="#01999A">
                            <td width="50%">
                            <table cellpadding="0" cellspacing="0" border="0">
                            <tr>
                                <td height="7"></td>
                            </tr>
                            <tr>
                                <td width="10%"></td>
                                <td>
                                    <a style="color: #fff; padding: 0 0 0 10px; text-decoration: none;" href="https://devfundraising.wpengine.com/">www.fundraising.com</a>
                                </td>
                            </tr>
                            <tr>
                                <td height="7"></td>
                            </tr>
                            </table>
                            </td>
                                <td></td>
                                <td width="50%">
                                <table cellpadding="0" cellspacing="0" border="0" style="width: 100%">
                                <tr>
                                    <td height="7"></td>
                                </tr>
                                <tr align="right" class="social-icons">
                                    <td width="44%"></td>
                                    <td width="10%" align="right"><a href="#" valign="middle"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/youtube.png"></a></td>
                                    <td width="10%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/facebook.png"></a></td>
                                    <td width="5%"></td>
                                    <td width="10%" align="center" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/instagram.png"></a></td>
                                    <td width="5%"></td>
                                    <td width="8%" align="right" valign="middle"><a href="#"><img src="https://groovyyurts.com/wp-content/uploads/2020/07/twitter.png"></a></td>
                                    <td width="8%"></td>
                                </tr>
                                <tr>
                                <td height="7"></td>
                                    </tr>
                                </table>
                                </td>
                            </tr>
                        </table>
                    </body>
                    </html>';

                // $to="tanis.thai@sixdrops.org";
                // $to="steveprolimit+89127372192132138217@gmail.com";

         // Set content-type header for sending HTML email 
        $headers = "MIME-Version: 1.0" . "\r\n"; 
        $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
         
        // Additional headers 
        $headers .= 'From: '.$CurrentUserName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
        $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

        mail( $memberEmail , $fname, $htmlContent, $headers);
    }


    die();
}









// This is the function specified in the "add_action" above
function Add_Team_Alert_Msg( $post ) {
    
    if ('tribe_events' == get_post_type($post) ) {

        echo '<a  class="teambtn" onclick=alert_fund(); href="javascript:;">Add Team Members Here</a>';
    }
}
add_action( 'edit_form_after_title', 'Add_Team_Alert_Msg');


function fund_script(){?>
    
    <script>

        function alert_fund(){
            var yes = confirm('Do you want to add team?');
            if(yes){ 
                window.location = "/wp-admin/post-new.php?post_type=product";
            }
        }

    </script>
<?php  }

add_action( 'admin_enqueue_scripts', 'fund_script', 10000 );



// custom registration form and added password field
add_action( 'register_form', 'fundraising_registration_form' );
function fundraising_registration_form() {
	?>
    
    <label for="user_login"><?php _e('Password') ?></label>
    <input type="password" name="user_password" id="user_password" class="input" value="<?php echo esc_attr(wp_unslash($user_login)); ?>" size="25" />
	<?php
}

// Field validation
add_filter( 'registration_errors', 'wedevs_registration_errors', 10, 3 );
function fundraising_registration_errors( $errors, $sanitized_user_login, $user_email ) {

    if ( empty( $_POST['user_password'])  ) {
        $errors->add( 'first_or_last', __( '<strong>ERROR</strong>: First name is missing', 'fundraising' ) );
    }

    return $errors;
}

//saving form data
add_action( 'user_register', 'fundraising_save_data' );
function fundraising_save_data( $user_id ) {

    if ( isset( $_POST['user_password'] ) )
wp_set_password( $_POST['user_password'], $user_id );
}

//Shortcode for Donor Signup Page
function my_donor_signup_form_shortcode() {

   get_template_part('/registration-forms/donor_signup_form');
} 
add_shortcode( 'donor_signup_form', 'my_donor_signup_form_shortcode' );


//Shortcode for Donor login Page
function my_donor_login_form_shortcode() {
    ?>
    <!DOCTYPE html>
    <html>
    <head>
    </head>
    <body>
        <div class="main-form-row">
            <div class="inner-form-row">
                <div class="custom-form-signup">
                    <div class="form-logo">
                        <img src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png">
                    </div>
                    <div class="form-title">
                        <h1>Donor <span>Login</span></h1>
                    </div>
                    <div id="xyz" class="xyz">
                        <div class="main-class">
                            <?php wp_login_form(); ?>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    </html>
    <?php
} 
add_shortcode( 'donor_login_form', 'my_donor_login_form_shortcode' );


//Shortcode for Organizer Signup Page
function my_organizer_signup_form_shortcode() {
   // ob_start();
   get_template_part('/registration-forms/organizer_signup_form');
   // return ob_get_clean();   
} 
add_shortcode( 'organizer_signup_form', 'my_organizer_signup_form_shortcode' );

//Shortcode for Donor login Page
function my_Organizer_login_form_shortcode() {
    ?>
    <!DOCTYPE html>
    <html>
    <head>
    </head>
    <body>
        <div id="xyz" class="xyz" style="margin-top: 102px;padding: 100px 132px;">
        <h1>Organizer Login</h1>
            <div class="main-class">
                <?php wp_login_form(); ?>
            </div>
        </div>
    </body>
    </html>
    <?php
} 
add_shortcode( 'organizer_login_form', 'my_Organizer_login_form_shortcode' );


//Rename Product CategoryTaxomony

add_action( 'init', 'prodct_cat_rename');
function prodct_cat_rename()
{
    global $wp_taxonomies;

    $wp_taxonomies['product_cat']->labels = (object)array(
        'name' => 'Add New Team',
        'menu_name' => 'Add New Team',
        // 'singular_name' => 'WPA 4182 Tag',
        'search_items' => 'Search Team',
        'popular_items' => 'Popular Team',
        'all_items' => 'All Teams',
        // 'parent_item' => null, // Tags aren't hierarchical
        // 'parent_item_colon' => null,
        'edit_item' => 'Edit Team',
        'update_item' => 'Update Team',
        'add_new_item' => 'Add new Team',
        'new_item_name' => 'Add New Team',
        'separate_items_with_commas' => 'Separate Teams With Comma',
        'add_or_remove_items' => 'Add or remove Teams',
        'choose_from_most_used' => 'Choose from the most Team',
    );

    $wp_taxonomies['product_cat']->label = 'Add New Team';
}

//Rename Product Page
function change_post_object_label() {
    global $wp_post_types;
    $labels = $wp_post_types['product']->labels;
    $labels->name = 'Product/Team';
    $labels->singular_name = 'Team Member';
    // $labels->menu_name => 'Add New Member',
    // $labels->product_cat = 'teste';
    $labels->add_new_item = 'Add New Member';
    $labels->edit_item = 'Edit Member';
    $labels->new_item = 'Add New Member';
    $labels->all_items = 'All Products/Members';
    $labels->view_item = 'View Members';
    $labels->search_items = 'Search Team Members';
    $labels->not_found = 'No Team Member Found';
    $labels->not_found_in_trash = 'No Member found in Trash';    
}
add_action( 'init', 'change_post_object_label', 999 );

function change_post_menu_label_fund() {
  global $menu;
  $menu[27][0] = 'Product/Team'; // Replace the 27 with your custom post type menu index from displayed above $menu array 

}
add_action( 'admin_menu', 'change_post_menu_label_fund' );


// Adding custom fields to the wordpress user dashboard profile
add_action( 'show_user_profile', 'extra_user_profile_fields' );
add_action( 'edit_user_profile', 'extra_user_profile_fields' );

function extra_user_profile_fields( $user ) { ?>
    <h3><?php _e("Organization Information", "blank"); ?></h3>

    <table class="form-table">
        <tr>
            <th><label for="orgname"><?php _e("Team Name"); ?></label></th>
            <td>
                <input type="text" name="team_name" id="team_name" value="<?php echo esc_attr( get_the_author_meta( 'team_name', $user->ID ) ); ?>" class="regular-text" /><br />
                <span class="description"><?php _e("Team Name"); ?></span>
            </td>
        </tr> 
        <tr>
            <th><label for="orgname"><?php _e("Organization Name"); ?></label></th>
            <td>
                <input type="text" name="organization_name" id="organization_name" value="<?php echo esc_attr( get_the_author_meta( 'organization_name', $user->ID ) ); ?>" class="regular-text" /><br />
                <span class="description"><?php _e("Please enter your Org name."); ?></span>
            </td>
        </tr>    
        <tr>
            <th><label for="address"><?php _e("Organization Address"); ?></label></th>
            <td>
                <input type="text" name="address" id="address" value="<?php echo esc_attr( get_the_author_meta( 'address', $user->ID ) ); ?>" class="regular-text" /><br />
                <span class="description"><?php _e("Please enter your Org address."); ?></span>
            </td>
        </tr>
    </table>
<?php }


//saving custom filed profile data
add_action( 'personal_options_update', 'save_extra_user_profile_fields' );
add_action( 'edit_user_profile_update', 'save_extra_user_profile_fields' );

function save_extra_user_profile_fields( $user_id ) {
    if ( !current_user_can( 'edit_user', $user_id ) ) { 
        return false; 
    }
    update_user_meta( $user_id, 'organization_name', $_POST['organization_name'] );
    update_user_meta( $user_id, 'address', $_POST['address'] );
}


add_action('acf/save_post', 'my_acf_save_post', 5);
function my_acf_save_post( $post_id ) {

    // Get previous values.
    $prev_values = get_fields( $post_id );

    // Get submitted values.
    $values = $_POST['acf'];

    // get user data
    $CurrentUserData = wp_get_current_user();
    $CurrentUserEmail =$CurrentUserData->data->user_email;
    $CurrentUserName =$CurrentUserData->data->display_name;
    // die($CurrentUserEmail);


    //Function for Random Password Generator
    function generateRandomString($length = 10) {
        return substr(str_shuffle(str_repeat($x='0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ', ceil($length/strlen($x)) )),1,$length);
    }
    $pass = generateRandomString();


    //Event Notification To Team Member about their event information
    if (!empty($values['field_5fdcf1db0c4bd'])) {
        
        // global $venueinfo;
        $PostMetaData=get_post_meta($values['field_5fdcf1db0c4bd']);
        $EventStartDate = $PostMetaData['_EventStartDate'][0];
        $EventEndDate = $PostMetaData['_EventEndDate'][0];
        $EventVenueID = $PostMetaData['_EventVenueID'][0];
        // $thumbnail_id = $PostMetaData['_thumbnail_id'][0];
        // $EventCost = $PostMetaData['_EventCost'][0];
        $EventAllDay = $PostMetaData['_EventAllDay'][0];
        $OrgWhoCreated = $PostMetaData['_wxr_import_user_slug'][0];
        $venueinfo = tribe_get_venue($EventVenueID);
        $postData=get_post($values['field_5fdcf1db0c4bd']);
        $EventName = $postData->post_title;
        $MemberEmail = $values['field_5fdc938172553'];
        $MemberName = $values['field_5fdc932472552'];

        
        if (isset($CurrentUserEmail)) {

            $body = 'Event Organizer:'.$OrgWhoCreated."\r\n".'Event Name: '.$EventName."\r\n".' Event Venue: '.$venueinfo."\r\n".'Event Start d/t :'.$EventStartDate."\r\n".'Event End d/t :'.$EventEndDate."\r\n".'All Day Event : '.$EventAllDay;
            $htmlContent = '<html> 
                            <head>  
                            </head> 
                            <body>
                                <img class="emailImage" src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png"> 
                                <h1>Event Information!</h1> 
                                <table class="tableEmail" style="border: 2px dashed #FB4314; width: 100%;"> 
                                    <tr> 
                                        <th>Event Organizer:</th><td>'.$OrgWhoCreated.'</td> 
                                    </tr> 
                                    <tr> 
                                        <th>Event Name:</th><td>'.$EventName.'</td> 
                                    </tr> 
                                    <tr > 
                                        <th>Event Venue:</th><td>'.$venueinfo.'</td> 
                                    </tr>
                                    <tr > 
                                        <th>Event Start d/t :</th><td>'.$EventStartDate.'</td> 
                                    </tr>
                                    <tr > 
                                        <th>Event End d/t :</th><td>'.$EventEndDate.'</td> 
                                    </tr>
                                    <tr > 
                                        <th>All Day Event :</th><td>'.$EventAllDay.'</td> 
                                    </tr>

                                     <p> Website:<a href="/"> www.fundraisingevent.com</a></p>
                                </table> 
                            </body>
                                <footer> <small>Copyright &copy; 2021, Fundraising Event</small></footer>  
                            </html>';
        // Set content-type header for sending HTML email 
        $headers = "MIME-Version: 1.0" . "\r\n"; 
        $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
         
        // Additional headers 
        $headers .= 'From: '.$MemberName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
        $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 
                            

        mail($MemberEmail ,$MemberName, $htmlContent, $headers);
        
        }
    }

   

    
    // Create post object
    if (isset($values['field_5fe06ee2c16ec'])) {
    
    $assign_evnt_id = $values['field_5fe06ee2c16ec'];   
    $my_post_evnt = array(
      'ID'            => get_the_ID(),  
      'post_title'    => $_POST['post_title'],
      'post_content'  => $_POST['post_content'],
      'post_status'   => 'publish',
      'post_author'   => $assign_evnt_id,
      'post_type'     => 'tribe_events',      
      // 'post_category' => array( 8,39 )
    );

    // Insert the post into the database
    $created_evnt = wp_insert_post( $my_post_evnt, true );
    $venuelocation = tribe_get_venue(get_the_ID());

    //Email to Organizer for Event Scheduling
      if ($created_evnt) {

         $user_info = get_userdata($values['field_5fe06ee2c16ec']);     
         $to = $user_info->user_email; 
         
        $event_name = $_POST['post_title'];
        $htmlContent = '<html> 
                        <head>  
                        </head> 
                        <body>
                            <img class="emailImage" src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png"> 
                            <h1>Event Information!</h1> 
                            <table class="tableEmail" style="border: 2px dashed #FB4314; width: 100%;"> 
                                <tr> 
                                    <th>Event Name:</th><td>'.$_POST["post_title"].'</td> 
                                </tr> 
                                <tr > 
                                    <th>Event Venue:</th><td>'.$venuelocation.'</td> 
                                </tr>
                                <tr > 
                                    <th>Event Start d/t :</th><td>'.$_POST["EventStartDate"]." ".$_POST["EventStartTime"].'</td> 
                                </tr>
                                <tr > 
                                    <th>Event End d/t :</th><td>'.$_POST["EventEndDate"]." ".$_POST["EventEndTime"].'</td> 
                                </tr>

                                 <p> Website:<a href="/"> www.fundraisingevent.com</a></p>
                            </table> 
                        </body>
                            <footer> <small>Copyright &copy; 2021, Fundraising Event</small></footer>  
                        </html>';

        // Set content-type header for sending HTML email 
        $headers = "MIME-Version: 1.0" . "\r\n"; 
        $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
         
        // Additional headers 
        $headers .= 'From: '.$MemberName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
        $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

        mail($to , $event_name, $htmlContent, $headers);
    }
 }


    // Created a new Team Member using CF and Email them.
    if(!empty($values['field_5fdc932472552']) && !empty($values['field_5fdc938172553']) ) {
        
        $MemberEmail = $values['field_5fdc938172553'];
        $MemberName = $values['field_5fdc932472552'];
        $created = wp_create_user( $MemberName, $pass, $MemberEmail );
        $user = new WP_User($created);
        $user->set_role('give_worker');

        if($created){

            $htmlContent = '<html> 
                            <head>  
                            </head> 
                            <body>
                                <img class="emailImage" src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png"> 
                                <h1>Account Information!</h1> 
                                <table class="tableEmail" style="border: 2px dashed #FB4314; width: 100%;"> 
                                    <tr> 
                                        <th>Name:</th><td>'.$MemberName.'</td> 
                                    </tr> 
                                    <tr > 
                                        <th>Email:</th><td>'.$MemberEmail.'</td> 
                                    </tr>
                                    <tr > 
                                        <th>Password:</th><td>'.$pass.'</td> 
                                    </tr>
                                     <p> Website:<a href="/"> www.fundraisingevent.com</a></p>
                                </table> 
                            </body>
                                <footer> <small>Copyright &copy; 2021, Fundraising Event</small></footer>  
                            </html>';

             // Set content-type header for sending HTML email 
            $headers = "MIME-Version: 1.0" . "\r\n"; 
            $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
             
            // Additional headers 
            $headers .= 'From: '.$MemberName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
            $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

            mail($MemberEmail ,$MemberName, $htmlContent, $headers);
        }
    }


    

    //Created & Email to New Organizer for there account credentials
    if(!empty($values) ) {
        
        $created_org = wp_create_user( $values['field_5fe0d0df24b16'], $pass, $values['field_5fe0d0f424b17'] );
        $user = new WP_User($created_org);
        $user->set_role('give_manager');

        if(!empty($user)){

            $to = $values['field_5fe0d0f424b17'];
            $name = $values['field_5fe0d0df24b16'];
            $htmlContent = '<html> 
                            <head>  
                            </head> 
                            <body>
                                <img class="emailImage" src="https://devfundraising.wpengine.com/wp-content/uploads/2020/12/form-logo.png"> 
                                <h1>Account Information!</h1> 
                                <table class="tableEmail" style="border: 2px dashed #FB4314; width: 100%;"> 
                                    <tr> 
                                        <th>Name:</th><td>'.$name.'</td> 
                                    </tr> 
                                    <tr > 
                                        <th>Email:</th><td>'.$to.'</td> 
                                    </tr>
                                    <tr > 
                                        <th>Password:</th><td>'.$pass.'</td> 
                                    </tr>
                                     <p> Website:<a href="/"> www.fundraisingevent.com</a></p>
                                </table> 
                            </body>
                                <footer> <small>Copyright &copy; 2021, Fundraising Event</small></footer>  
                            </html>';
            // Set content-type header for sending HTML email 
            $headers = "MIME-Version: 1.0" . "\r\n"; 
            $headers .= "Content-type:text/html;charset=UTF-8" . "\r\n"; 
             
            // Additional headers 
            $headers .= 'From: '.$MemberName.'<'.$CurrentUserEmail.'>' . "\r\n"; 
            $headers .= 'Reply-to:'.$CurrentUserEmail. "\r\n"; 

            mail($to ,$name, $htmlContent, $headers);
        }
    }else{
    	echo "Failed to create USER!";
    }
 }



 function acf_load_color_field_choices( $field ) {

    $field['choices'] = array();

    $uid=get_current_user_id();

    $args = array(
            'posts_per_page'   => -1,
            'post_type'        => 'tribe_events',
            'author'         => $uid,
            'post_status' => 'publish',

        );
    $data=get_posts($args);
    foreach ($data as $key => $value) {
        if(!empty($value->post_title)){
            $field['choices'][$value->ID]=$value->post_title;
        }
    }

    return $field;    

}

add_filter('acf/load_field/name=events', 'acf_load_color_field_choices');



function admin_default_page() {
  return '/';
}

add_filter('login_redirect', 'admin_default_page');

function admin_default() {
  return '/';
}

add_filter('logout_redirect', 'admin_default');


// To change add to cart text on product archives(Collection) page
add_filter( 'woocommerce_product_add_to_cart_text', 'woocommerce_custom_product_add_to_cart_text' );  
function woocommerce_custom_product_add_to_cart_text() {
    return __( 'Sponsor', 'woocommerce' );
 }



 add_action( 'woocommerce_after_shop_loop_item_title', 'wc_add_short_description' );

function wc_add_short_description() {
    global $product;

    ?>
        <div class="discription-hol">
            <div itemprop="description" class="discriptions">
                <?php //echo apply_filters( 'the_content', $product->post->post_content ) ?>
                <?php echo apply_filters( 'woocommerce_short_description', $product->post->post_excerpt, 10 ) ?>
            </div>
            <div class="socialMedia">
                <ul>
                    <li><a href="<?php echo get_field( 'facebook' );?>"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
                    <li><a href="<?php echo get_field( 'instagram' );?>"><i class="fa fa-instagram" aria-hidden="true"></i></a></li>
                    <li><a href="<?php echo get_field( 'twitter' );?>"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
                    <li><a href="<?php echo get_field( 'linkedin' );?>"><i class="fa fa-linkedin" aria-hidden="true"></i></a></li>
                    <li><a href="<?php echo get_field( 'google' );?>"><i class="fa fa-google" aria-hidden="true"></i></a></li>
                </ul>
            </div>
        </div>

    <?php
}



add_filter( 'woocommerce_placeholder_img_src', 'magik_custom_woocommerce_placeholder', 10 );

//  Function to return new placeholder image URL. 
function magik_custom_woocommerce_placeholder( $image_url )
 {
    $image_url = 'https://devfundraising.wpengine.com/wp-content/uploads/2021/01/placeholderImage.jpg'; 
   // change  this to the URL to your custom placeholder
    return $image_url;
 }

add_filter( 'woocommerce_before_single_product', 'banner_image',28 );
function banner_image()
{   ?>

    <section class="banner-sec bannernew">
        <div class="container">
            <div class="banner-holder">
                <h1>Member Shop</h1>
                <ul class="breadcrumb">
                    <li><a href="/">Home</a></li>
                    <li>Product</li>
                </ul>
            </div>
        </div>
    </section>
    
<?php }


//Shortcode for Contact Page
function contact_page_shortcode() {
    
    ob_start();
    $my_id = 312;
    $post_id_312 = get_post($my_id);
    $content = $post_id_312->post_content;
    $content = apply_filters('the_content', $content);
    $content = str_replace(']]>', ']]>', $content);
    echo $content;
    return ob_get_clean();
} 
add_shortcode( 'contact_page', 'contact_page_shortcode' );

// $my_id = 26;
// $post_id_26 = get_post($my_id);
// $content = $post_id_26->post_content;
//     $trimmed=wp_trim_words($content, 3000);
// echo "<pre>";
// print_r($content);
// die();

//Shortcode for About Page Section
function aboutus_page_shortcode() {
    
    ob_start();
    $my_id = 26;
    $post_id_26 = get_post($my_id);
    $content = $post_id_26->post_content;
    $content = apply_filters('the_content', $content);
    $content = str_replace(']]>', ']]>', $content);
    echo $content;
    return ob_get_clean();
} 
add_shortcode( 'about_page', 'aboutus_page_shortcode' );



add_action( 'wp_enqueue_scripts', 'the_dramatist_enqueue_scripts' );
// add_filter( 'ajax_query_attachments_args', 'the_dramatist_filter_media' );
add_shortcode( 'the_dramatist_front_upload', 'the_dramatist_front_upload' );

/**
 * Call wp_enqueue_media() to load up all the scripts we need for media uploader
 */
function the_dramatist_enqueue_scripts() {
    wp_enqueue_media();
    wp_enqueue_script(
        'some-script',
        get_stylesheet_directory_uri() . '/js/media-uploader.js',
        array( 'jquery' ),
        null
    );
}

function the_dramatist_front_upload() {
    // check if user can upload files
    if ( is_user_logged_in() ) {
        $str = __( 'Select T-Shirt Template' );
         return '<input id="frontend-button" type="button" value="' . $str . '" class="button" style="position: relative; z-index: 1;"><img id="frontend-image" />';
    }
    return __( 'Please Login To Select Template', 'text-domain' );
}
